<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Nihongo Quest: JLPT N5 Master</title>

    <style>

        :root {

            --primary: #6C5CE7;

            --accent: #00CEC9;

            --dark: #2D3436;

            --card: #ffffff;

            --text: #2D3436;

            --success: #00B894;

            --error: #FF7675;

            --gold: #FDCB6E;

        }



        body {

            font-family: 'Segoe UI', sans-serif;

            background-color: var(--dark);

            color: white;

            margin: 0;

            display: flex;

            justify-content: center;

            min-height: 100vh;

            overflow-x: hidden;

            user-select: none;

        }



        #app {

            width: 100%;

            max-width: 480px;

            background: linear-gradient(180deg, #2D3436 0%, #1e272e 100%);

            min-height: 100vh;

            position: relative;

            display: flex;

            flex-direction: column;

            box-shadow: 0 0 50px rgba(0,0,0,0.5);

        }



        /* --- HEADER & STREAK --- */

        .header {

            padding: 20px;

            display: flex;

            justify-content: space-between;

            align-items: center;

            background: rgba(0,0,0,0.2);

        }



        .streak-box {

            background: rgba(255,100,100,0.2);

            padding: 5px 15px;

            border-radius: 20px;

            border: 1px solid rgba(255,100,100,0.4);

            font-weight: bold;

            display: flex;

            align-items: center;

            gap: 5px;

        }



        /* --- HOME MENU --- */

        .menu-grid {

            display: grid;

            grid-template-columns: 1fr 1fr;

            gap: 15px;

            padding: 20px;

            animation: fadeIn 0.5s ease;

        }



        .menu-card {

            background: rgba(255,255,255,0.05);

            border: 1px solid rgba(255,255,255,0.1);

            border-radius: 15px;

            padding: 20px;

            text-align: center;

            cursor: pointer;

            transition: all 0.2s;

            position: relative;

            overflow: hidden;

        }



        .menu-card:hover {

            transform: translateY(-5px);

            background: rgba(255,255,255,0.1);

            border-color: var(--primary);

        }



        .menu-card h3 { margin: 10px 0 5px; font-size: 1.1rem; }

        .menu-card p { font-size: 0.8rem; opacity: 0.6; margin: 0; }

        .icon { font-size: 2rem; }



        /* --- GAMEPLAY UI --- */

        .game-screen {

            display: none; /* Hidden by default */

            flex: 1;

            flex-direction: column;

            padding: 20px;

        }



        .progress-container {

            width: 100%;

            height: 6px;

            background: rgba(255,255,255,0.1);

            border-radius: 3px;

            margin-bottom: 20px;

        }

        .progress-fill {

            height: 100%;

            background: var(--accent);

            width: 0%;

            transition: width 0.3s;

        }



        .flashcard {

            background: white;

            color: var(--text);

            border-radius: 20px;

            padding: 40px 20px;

            text-align: center;

            margin-bottom: 20px;

            box-shadow: 0 10px 30px rgba(0,0,0,0.3);

            animation: slideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);

            position: relative;

        }



        .main-text { font-size: 4rem; font-weight: 800; line-height: 1.2; }

        .sub-text { font-size: 1rem; color: #636e72; margin-top: 5px; min-height: 1.2em;}

        .badge-icon { position: absolute; top: -10px; right: -10px; font-size: 2rem; display: none; }



        .options-container {

            display: grid;

            grid-template-columns: 1fr;

            gap: 12px;

        }



        .option-btn {

            background: rgba(255,255,255,0.08);

            border: 2px solid rgba(255,255,255,0.1);

            color: white;

            padding: 16px;

            border-radius: 12px;

            font-size: 1.1rem;

            cursor: pointer;

            transition: 0.2s;

            text-align: left;

            position: relative;

        }



        .option-btn:hover { background: rgba(255,255,255,0.15); }

        .option-btn.correct { background: var(--success); border-color: var(--success); }

        .option-btn.wrong { background: var(--error); border-color: var(--error); }



        /* --- RESULTS MODAL --- */

        .modal {

            display: none;

            position: fixed;

            top: 0; left: 0; width: 100%; height: 100%;

            background: rgba(0,0,0,0.9);

            z-index: 100;

            justify-content: center;

            align-items: center;

            padding: 20px;

            box-sizing: border-box;

        }

        .modal-content {

            background: #2d3436;

            border: 1px solid #636e72;

            padding: 30px;

            border-radius: 20px;

            text-align: center;

            max-width: 400px;

            width: 100%;

            animation: popIn 0.3s;

        }

        .result-score { font-size: 3rem; font-weight: bold; color: var(--accent); }

        .btn-home { background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 25px; font-size: 1.1rem; cursor: pointer; margin-top: 20px; width: 100%; }



        /* --- ANIMATIONS --- */

        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        .shake { animation: shake 0.3s; }



        /* Utility */

        .hidden { display: none !important; }



    </style>

</head>

<body>



<div id="app">

    

    <div class="header">

        <div style="font-weight:bold; font-size:1.2rem;">üáØüáµ Nihongo Quest</div>

        <div class="streak-box">

            <span>üî•</span> <span id="streak-count">0</span> Day Streak

        </div>

    </div>



    <div id="home-screen" class="menu-grid">

        <div class="menu-card" onclick="startMode('kana')">

            <div class="icon">„ÅÇ</div>

            <h3>Kana Drill</h3>

            <p>Hiragana & Katakana</p>

        </div>

        

        <div class="menu-card" onclick="startMode('kanji')">

            <div class="icon">Êº¢</div>

            <h3>N5 Kanji</h3>

            <p>Meanings & Readings</p>

        </div>



        <div class="menu-card" onclick="startMode('vocab')">

            <div class="icon">Ë™û</div>

            <h3>Vocabulary</h3>

            <p>Essential Words</p>

        </div>



        <div class="menu-card" style="border-color: var(--gold);" onclick="startMode('exam')">

            <div class="icon">üèÜ</div>

            <h3>JLPT Exam</h3>

            <p>20 Mixed Questions</p>

        </div>



        <div style="grid-column: 1 / -1; margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">

            <div style="font-size: 0.9rem; margin-bottom: 10px;">üèÜ Badges Earned</div>

            <div id="badge-container" style="display:flex; gap:10px; font-size: 1.5rem;">

                <span style="opacity:0.2" id="badge-n5">üèÖ</span>

                <span style="opacity:0.2" id="badge-speed">‚ö°</span>

                <span style="opacity:0.2" id="badge-streak">üî•</span>

            </div>

        </div>

    </div>



    <div id="game-screen" class="game-screen">

        <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:0.9rem; opacity:0.7;">

            <span id="mode-label">Mode</span>

            <span id="q-counter">1/10</span>

        </div>

        

        <div class="progress-container">

            <div class="progress-fill" id="progress-bar"></div>

        </div>



        <div class="flashcard" id="card">

            <div class="badge-icon" id="card-badge">‚ú®</div>

            <div class="main-text" id="question-text">?</div>

            <div class="sub-text" id="question-sub"></div>

        </div>



        <div class="options-container" id="options-box">

            </div>



        <button onclick="goHome()" style="margin-top: auto; background:none; border:none; color:white; opacity:0.5; cursor:pointer;">Exit to Menu</button>

    </div>



    <div id="result-modal" class="modal">

        <div class="modal-content">

            <div style="font-size: 3rem; margin-bottom: 10px;">üéâ</div>

            <h2>Session Complete!</h2>

            <div class="result-score" id="final-score">85%</div>

            <p id="result-msg">Great job!</p>

            <button class="btn-home" onclick="goHome()">Back to Home</button>

        </div>

    </div>



</div>



<script>

    // --- DATABASE (Mini N5 Set) ---

    const DB = {

        kana: [

            // HIRAGANA

{ q: '„ÅÇ', a: 'a', type: 'h' }, { q: '„ÅÑ', a: 'i', type: 'h' }, { q: '„ÅÜ', a: 'u', type: 'h' }, { q: '„Åà', a: 'e', type: 'h' }, { q: '„Åä', a: 'o', type: 'h' },

{ q: '„Åã', a: 'ka', type: 'h' }, { q: '„Åç', a: 'ki', type: 'h' }, { q: '„Åè', a: 'ku', type: 'h' }, { q: '„Åë', a: 'ke', type: 'h' }, { q: '„Åì', a: 'ko', type: 'h' },

{ q: '„Åï', a: 'sa', type: 'h' }, { q: '„Åó', a: 'shi', type: 'h' }, { q: '„Åô', a: 'su', type: 'h' }, { q: '„Åõ', a: 'se', type: 'h' }, { q: '„Åù', a: 'so', type: 'h' },

{ q: '„Åü', a: 'ta', type: 'h' }, { q: '„Å°', a: 'chi', type: 'h' }, { q: '„Å§', a: 'tsu', type: 'h' }, { q: '„Å¶', a: 'te', type: 'h' }, { q: '„Å®', a: 'to', type: 'h' },

{ q: '„Å™', a: 'na', type: 'h' }, { q: '„Å´', a: 'ni', type: 'h' }, { q: '„Å¨', a: 'nu', type: 'h' }, { q: '„Å≠', a: 'ne', type: 'h' }, { q: '„ÅÆ', a: 'no', type: 'h' },

{ q: '„ÅØ', a: 'ha', type: 'h' }, { q: '„Å≤', a: 'hi', type: 'h' }, { q: '„Åµ', a: 'fu', type: 'h' }, { q: '„Å∏', a: 'he', type: 'h' }, { q: '„Åª', a: 'ho', type: 'h' },

{ q: '„Åæ', a: 'ma', type: 'h' }, { q: '„Åø', a: 'mi', type: 'h' }, { q: '„ÇÄ', a: 'mu', type: 'h' }, { q: '„ÇÅ', a: 'me', type: 'h' }, { q: '„ÇÇ', a: 'mo', type: 'h' },

{ q: '„ÇÑ', a: 'ya', type: 'h' }, { q: '„ÇÜ', a: 'yu', type: 'h' }, { q: '„Çà', a: 'yo', type: 'h' },

{ q: '„Çâ', a: 'ra', type: 'h' }, { q: '„Çä', a: 'ri', type: 'h' }, { q: '„Çã', a: 'ru', type: 'h' }, { q: '„Çå', a: 're', type: 'h' }, { q: '„Çç', a: 'ro', type: 'h' },

{ q: '„Çè', a: 'wa', type: 'h' }, { q: '„Çí', a: 'wo', type: 'h' }, { q: '„Çì', a: 'n', type: 'h' },



// HIRAGANA DAKUTEN / HANDAKUTEN

{ q: '„Åå', a: 'ga', type: 'h' }, { q: '„Åé', a: 'gi', type: 'h' }, { q: '„Åê', a: 'gu', type: 'h' }, { q: '„Åí', a: 'ge', type: 'h' }, { q: '„Åî', a: 'go', type: 'h' },

{ q: '„Åñ', a: 'za', type: 'h' }, { q: '„Åò', a: 'ji', type: 'h' }, { q: '„Åö', a: 'zu', type: 'h' }, { q: '„Åú', a: 'ze', type: 'h' }, { q: '„Åû', a: 'zo', type: 'h' },

{ q: '„Å†', a: 'da', type: 'h' }, { q: '„Å¢', a: 'ji', type: 'h' }, { q: '„Å•', a: 'zu', type: 'h' }, { q: '„Åß', a: 'de', type: 'h' }, { q: '„Å©', a: 'do', type: 'h' },

{ q: '„Å∞', a: 'ba', type: 'h' }, { q: '„Å≥', a: 'bi', type: 'h' }, { q: '„Å∂', a: 'bu', type: 'h' }, { q: '„Åπ', a: 'be', type: 'h' }, { q: '„Åº', a: 'bo', type: 'h' },

{ q: '„Å±', a: 'pa', type: 'h' }, { q: '„Å¥', a: 'pi', type: 'h' }, { q: '„Å∑', a: 'pu', type: 'h' }, { q: '„Å∫', a: 'pe', type: 'h' }, { q: '„ÅΩ', a: 'po', type: 'h' },



// KATAKANA

{ q: '„Ç¢', a: 'a', type: 'k' }, { q: '„Ç§', a: 'i', type: 'k' }, { q: '„Ç¶', a: 'u', type: 'k' }, { q: '„Ç®', a: 'e', type: 'k' }, { q: '„Ç™', a: 'o', type: 'k' },

{ q: '„Ç´', a: 'ka', type: 'k' }, { q: '„Ç≠', a: 'ki', type: 'k' }, { q: '„ÇØ', a: 'ku', type: 'k' }, { q: '„Ç±', a: 'ke', type: 'k' }, { q: '„Ç≥', a: 'ko', type: 'k' },

{ q: '„Çµ', a: 'sa', type: 'k' }, { q: '„Ç∑', a: 'shi', type: 'k' }, { q: '„Çπ', a: 'su', type: 'k' }, { q: '„Çª', a: 'se', type: 'k' }, { q: '„ÇΩ', a: 'so', type: 'k' },

{ q: '„Çø', a: 'ta', type: 'k' }, { q: '„ÉÅ', a: 'chi', type: 'k' }, { q: '„ÉÑ', a: 'tsu', type: 'k' }, { q: '„ÉÜ', a: 'te', type: 'k' }, { q: '„Éà', a: 'to', type: 'k' },

{ q: '„Éä', a: 'na', type: 'k' }, { q: '„Éã', a: 'ni', type: 'k' }, { q: '„Éå', a: 'nu', type: 'k' }, { q: '„Éç', a: 'ne', type: 'k' }, { q: '„Éé', a: 'no', type: 'k' },

{ q: '„Éè', a: 'ha', type: 'k' }, { q: '„Éí', a: 'hi', type: 'k' }, { q: '„Éï', a: 'fu', type: 'k' }, { q: '„Éò', a: 'he', type: 'k' }, { q: '„Éõ', a: 'ho', type: 'k' },

{ q: '„Éû', a: 'ma', type: 'k' }, { q: '„Éü', a: 'mi', type: 'k' }, { q: '„É†', a: 'mu', type: 'k' }, { q: '„É°', a: 'me', type: 'k' }, { q: '„É¢', a: 'mo', type: 'k' },

{ q: '„É§', a: 'ya', type: 'k' }, { q: '„É¶', a: 'yu', type: 'k' }, { q: '„É®', a: 'yo', type: 'k' },

{ q: '„É©', a: 'ra', type: 'k' }, { q: '„É™', a: 'ri', type: 'k' }, { q: '„É´', a: 'ru', type: 'k' }, { q: '„É¨', a: 're', type: 'k' }, { q: '„É≠', a: 'ro', type: 'k' },

{ q: '„ÉØ', a: 'wa', type: 'k' }, { q: '„É≤', a: 'wo', type: 'k' }, { q: '„É≥', a: 'n', type: 'k' },



// KATAKANA DAKUTEN / HANDAKUTEN

{ q: '„Ç¨', a: 'ga', type: 'k' }, { q: '„ÇÆ', a: 'gi', type: 'k' }, { q: '„Ç∞', a: 'gu', type: 'k' }, { q: '„Ç≤', a: 'ge', type: 'k' }, { q: '„Ç¥', a: 'go', type: 'k' },

{ q: '„Ç∂', a: 'za', type: 'k' }, { q: '„Ç∏', a: 'ji', type: 'k' }, { q: '„Ç∫', a: 'zu', type: 'k' }, { q: '„Çº', a: 'ze', type: 'k' }, { q: '„Çæ', a: 'zo', type: 'k' },

{ q: '„ÉÄ', a: 'da', type: 'k' }, { q: '„ÉÇ', a: 'ji', type: 'k' }, { q: '„ÉÖ', a: 'zu', type: 'k' }, { q: '„Éá', a: 'de', type: 'k' }, { q: '„Éâ', a: 'do', type: 'k' },

{ q: '„Éê', a: 'ba', type: 'k' }, { q: '„Éì', a: 'bi', type: 'k' }, { q: '„Éñ', a: 'bu', type: 'k' }, { q: '„Éô', a: 'be', type: 'k' }, { q: '„Éú', a: 'bo', type: 'k' },

{ q: '„Éë', a: 'pa', type: 'k' }, { q: '„Éî', a: 'pi', type: 'k' }, { q: '„Éó', a: 'pu', type: 'k' }, { q: '„Éö', a: 'pe', type: 'k' }, { q: '„Éù', a: 'po', type: 'k' }

        ],

        kanji: [

            { q: 'Êó•', a: 'Day / Sun', sub: 'nichi' }, { q: '‰∏Ä', a: 'One', sub: 'ichi' },

            { q: 'ÂõΩ', a: 'Country', sub: 'koku' }, { q: '‰∫∫', a: 'Person', sub: 'jin' },

            { q: 'Âπ¥', a: 'Year', sub: 'nen' }, { q: 'Â§ß', a: 'Big', sub: 'dai' },

            { q: 'Êú¨', a: 'Book / Origin', sub: 'hon' }, { q: '‰∏≠', a: 'Inside / Middle', sub: 'naka' },

            { q: 'Èï∑', a: 'Long / Leader', sub: 'naga' }, { q: 'Âá∫', a: 'Exit', sub: 'de' },

            { q: '‰∏â', a: 'Three', sub: 'san' }, { q: 'ÊôÇ', a: 'Time', sub: 'ji' }

        ],

        vocab: [

            { q: 'Áå´', a: 'Cat', sub: 'neko' }, { q: 'Áä¨', a: 'Dog', sub: 'inu' },

            { q: 'Â≠¶Áîü', a: 'Student', sub: 'gakusei' }, { q: 'ÂÖàÁîü', a: 'Teacher', sub: 'sensei' },

            { q: 'Â≠¶Ê†°', a: 'School', sub: 'gakkou' }, { q: 'È£ü„Åπ„Çã', a: 'To Eat', sub: 'taberu' },

            { q: 'È£≤„ÇÄ', a: 'To Drink', sub: 'nomu' }, { q: '‰ªäÊó•', a: 'Today', sub: 'kyou' },

            { q: 'ÊòéÊó•', a: 'Tomorrow', sub: 'ashita' }, { q: 'ÁßÅ', a: 'I / Me', sub: 'watashi' }

        ]

    };



    // --- STATE MANAGEMENT ---

    let state = {

        mode: null, // 'kana', 'kanji', 'vocab', 'exam'

        pool: [],

        currentQ: null,

        score: 0,

        total: 0,

        streak: 0,

        badges: []

    };



    // --- INITIALIZATION ---

    window.onload = () => {

        loadUserData();

        updateHomeUI();

    };



    function loadUserData() {

        const data = JSON.parse(localStorage.getItem('nihongoQuest')) || {};

        

        // Streak Logic

        const today = new Date().toDateString();

        if (data.lastLogin !== today) {

            const yesterday = new Date();

            yesterday.setDate(yesterday.getDate() - 1);

            

            if (data.lastLogin === yesterday.toDateString()) {

                state.streak = (data.streak || 0) + 1;

            } else {

                state.streak = 1; // Reset or Start

            }

            saveData(today);

        } else {

            state.streak = data.streak || 1;

        }



        state.badges = data.badges || [];

    }



    function saveData(dateString) {

        localStorage.setItem('nihongoQuest', JSON.stringify({

            streak: state.streak,

            lastLogin: dateString || new Date().toDateString(),

            badges: state.badges

        }));

    }



    function updateHomeUI() {

        document.getElementById('streak-count').innerText = state.streak;

        if(state.badges.includes('n5')) document.getElementById('badge-n5').style.opacity = '1';

        if(state.badges.includes('speed')) document.getElementById('badge-speed').style.opacity = '1';

        if(state.streak >= 7) document.getElementById('badge-streak').style.opacity = '1';

    }



    // --- GAME ENGINE ---

    function startMode(mode) {

        state.mode = mode;

        state.score = 0;

        state.total = 0;



        // Build Question Pool

        if (mode === 'exam') {

            // Mix all arrays, take 20 random

            let all = [...DB.kana, ...DB.kanji, ...DB.vocab];

            state.pool = shuffle(all).slice(0, 20);

        } else {

            // Infinite mode for practice

            state.pool = [...DB[mode]]; 

        }



        document.getElementById('home-screen').classList.add('hidden');

        document.getElementById('game-screen').style.display = 'flex';

        document.getElementById('mode-label').innerText = mode.toUpperCase() + (mode === 'exam' ? ' TEST' : ' PRACTICE');

        

        nextCard();

    }



    function nextCard() {

        // Exam Mode: Check if done

        if (state.mode === 'exam' && state.pool.length === 0) {

            endGame();

            return;

        }



        // Infinite Mode: Refill if empty

        if (state.mode !== 'exam' && state.pool.length === 0) {

            state.pool = [...DB[state.mode]];

        }



        // Pick Card

        const index = Math.floor(Math.random() * state.pool.length);

        state.currentQ = state.pool[index];

        

        // Remove from pool if Exam

        if (state.mode === 'exam') {

            state.pool.splice(index, 1);

        }



        renderCard();

    }



    function renderCard() {

        const q = state.currentQ;

        const card = document.getElementById('card');

        

        // Animation Reset

        card.style.animation = 'none';

        card.offsetHeight; /* trigger reflow */

        card.style.animation = 'slideIn 0.4s';



        document.getElementById('question-text').innerText = q.q;

        document.getElementById('question-sub').innerText = q.sub || ""; // Subtext for Kanji/Vocab reading

        

        // Update Counter

        state.total++;

        const displayTotal = state.mode === 'exam' ? 20 : state.total;

        document.getElementById('q-counter').innerText = `${state.total} / ${state.mode === 'exam' ? 20 : '‚àû'}`;

        document.getElementById('progress-bar').style.width = (state.total / displayTotal * 100) + "%";



        generateOptions(q);

    }



    function generateOptions(correct) {

        // Pick 3 wrong answers from the SAME category (important!)

        let dataset;

        if (state.mode === 'kana') dataset = DB.kana;

        else if (state.mode === 'kanji') dataset = DB.kanji;

        else if (state.mode === 'vocab') dataset = DB.vocab;

        else {

            // For Exam, detect type of current question

            if(DB.kana.includes(correct)) dataset = DB.kana;

            else if(DB.kanji.includes(correct)) dataset = DB.kanji;

            else dataset = DB.vocab;

        }



        let options = [correct];

        while(options.length < 4) {

            let r = dataset[Math.floor(Math.random() * dataset.length)];

            if(!options.includes(r)) options.push(r);

        }

        

        options = shuffle(options);



        const container = document.getElementById('options-box');

        container.innerHTML = '';



        options.forEach(opt => {

            const btn = document.createElement('button');

            btn.className = 'option-btn';

            btn.innerText = opt.a;

            btn.onclick = () => handleAnswer(opt, btn);

            container.appendChild(btn);

        });

    }



    function handleAnswer(selected, btn) {

        // Prevent double clicking

        if (btn.classList.contains('correct') || btn.classList.contains('wrong')) return;



        const isCorrect = selected === state.currentQ;

        

        // Visual Feedback

        const allBtns = document.querySelectorAll('.option-btn');

        allBtns.forEach(b => {

            if (b.innerText === state.currentQ.a) b.classList.add('correct');

        });



        if (isCorrect) {

            state.score++;

            playSound('correct');

        } else {

            btn.classList.add('wrong');

            document.getElementById('card').classList.add('shake');

            setTimeout(() => document.getElementById('card').classList.remove('shake'), 500);

            playSound('wrong');

        }



        // Voice

        if (state.currentQ.sub || state.currentQ.q.length < 3) {

            // Prioritize reading if available (sub), else the char itself

            const textToSpeak = state.currentQ.sub || state.currentQ.q;

            speak(textToSpeak);

        }



        setTimeout(nextCard, isCorrect ? 800 : 2000);

    }



    function endGame() {

        const modal = document.getElementById('result-modal');

        const percentage = Math.round((state.score / 20) * 100);

        

        document.getElementById('final-score').innerText = percentage + "%";

        

        let msg = "Keep practicing!";

        if (percentage >= 90) {

            msg = "Amazing! Mastery achieved!";

            unlockBadge('n5');

        } else if (percentage >= 70) {

            msg = "Good job! You passed.";

        }

        document.getElementById('result-msg').innerText = msg;



        modal.style.display = 'flex';

    }



    function unlockBadge(id) {

        if (!state.badges.includes(id)) {

            state.badges.push(id);

            saveData();

            // Show badge animation?

        }

    }



    function goHome() {

        document.getElementById('game-screen').style.display = 'none';

        document.getElementById('result-modal').style.display = 'none';

        document.getElementById('home-screen').classList.remove('hidden');

        updateHomeUI();

    }



    // --- UTILS ---

    function shuffle(array) {

        return array.sort(() => Math.random() - 0.5);

    }



    function speak(text) {

        const u = new SpeechSynthesisUtterance(text);

        u.lang = 'ja-JP';

        window.speechSynthesis.speak(u);

    }



    function playSound(type) {

        const ctx = new (window.AudioContext || window.webkitAudioContext)();

        const osc = ctx.createOscillator();

        const gain = ctx.createGain();

        osc.connect(gain);

        gain.connect(ctx.destination);



        const now = ctx.currentTime;

        if (type === 'correct') {

            osc.frequency.setValueAtTime(600, now);

            osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1);

            gain.gain.setValueAtTime(0.1, now);

            gain.gain.linearRampToValueAtTime(0, now + 0.15);

        } else {

            osc.type = 'sawtooth';

            osc.frequency.setValueAtTime(150, now);

            osc.frequency.linearRampToValueAtTime(100, now + 0.2);

            gain.gain.setValueAtTime(0.1, now);

            gain.gain.linearRampToValueAtTime(0, now + 0.2);

        }

        osc.start();

        osc.stop(now + 0.3);

    }



</script>

</body>

</html>
